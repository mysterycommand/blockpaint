(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{237:function(n,e,t){n.exports=t.p+"static/media/logo.02b2068a.svg"},238:function(n,e,t){n.exports=t(562)},252:function(n,e){},253:function(n,e){},273:function(n,e){},275:function(n,e){},486:function(n,e){},556:function(n,e,t){},557:function(n,e,t){},558:function(n,e,t){},559:function(n,e,t){},560:function(n,e,t){},561:function(n,e,t){},562:function(n,e,t){"use strict";t.r(e);var a=t(4),i=t.n(a),o=t(236),s=t.n(o),c=t(89),r=t(90),u=t(92),l=t(91),h=t(93),v=t(94),f=(t(556),t(557),function(n){function e(){var n,t;Object(c.a)(this,e);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(t=Object(u.a)(this,(n=Object(l.a)(e)).call.apply(n,[this].concat(i)))).state={canvasContext:null,canvasRect:null,isPainting:!1,prevX:-1,prevY:-1},t.handleMouse=function(n){n.preventDefault(),t.setState({isPainting:0!==n.buttons,prevX:-1,prevY:-1})},t.mousePaint=function(n){n.preventDefault(),t.paint(n.clientX,n.clientY)},t.handleTouch=function(n){t.setState({isPainting:0!==n.touches.length,prevX:-1,prevY:-1})},t.touchPaint=function(n){var e=Array.from(n.touches),a=e.reduce(function(n,e){return{clientX:n.clientX+e.clientX,clientY:n.clientY+e.clientY}},{clientX:0,clientY:0}),i=a.clientX,o=a.clientY;t.paint(i/e.length,o/e.length)},t.paint=function(n,e){var a=t.props.canvasRef.current,i=t.state,o=i.canvasContext,s=i.canvasRect,c=i.isPainting,r=i.prevX,u=i.prevY;if(a&&o&&s&&c){var l=o,h=s,v=h.x,f=h.y,g=h.width,p=h.height;l.canvas!==a&&console.warn("refs out of sync, rendering into a canvas that isn't in the DOM");var d=(n-v)*(a.width/g),m=(e-f)*(a.height/p);-1!==r&&-1!==u&&(l.moveTo(r,u),l.lineTo(d,m),l.stroke()),t.setState({prevX:d,prevY:m})}},t}return Object(h.a)(e,n),Object(r.a)(e,[{key:"componentDidMount",value:function(){var n=this,e=this.props,t=e.canvasRef.current,a=e.fetchPainting;t&&a&&(a().then(function(e){var a=JSON.parse(e||"{}").data;if(a){var i=n.state.canvasContext;if(i){var o=i,s=new Image(t.width,t.height);s.src=a,s.onload=function(){o.drawImage(s,0,0)}}}}),this.setState({canvasContext:t.getContext("2d"),canvasRect:t.getBoundingClientRect()}))}},{key:"render",value:function(){var n=this.props.canvasRef;return i.a.createElement("canvas",{ref:n,className:"canvas",width:"1080",height:"1080",onMouseEnter:this.handleMouse,onMouseDown:this.handleMouse,onMouseMove:this.mousePaint,onMouseUp:this.handleMouse,onMouseLeave:this.handleMouse,onTouchStart:this.handleTouch,onTouchMove:this.touchPaint,onTouchEnd:this.handleTouch})}}]),e}(a.Component)),g=(t(558),t(559),function(n){var e=n.children,t=n.onClick;return i.a.createElement("button",{className:"button",onClick:t},e)}),p=function(n){var e=n.canvasRef,t=n.fetchPainting,a=n.person,o=n.savePainting,s=n.signOut;return i.a.createElement("div",{className:"workspace"},i.a.createElement("header",{className:"header"},i.a.createElement("h2",{className:"current-user"},"Signed in as ",a.name()||"nameless person"),i.a.createElement(g,{onClick:s},"Sign out")),i.a.createElement(f,{canvasRef:e,fetchPainting:t}),i.a.createElement("footer",{className:"footer"},i.a.createElement("i",null),i.a.createElement(g,{onClick:o},"Save")))},d=(t(560),t(237)),m=t.n(d),w=function(n){var e=n.signIn;return i.a.createElement("header",{className:"splash"},i.a.createElement("img",{src:m.a,className:"splash-logo",alt:"logo"}),i.a.createElement(g,{onClick:e},"Sign in"))},S=function(n){function e(n){var t;Object(c.a)(this,e),(t=Object(u.a)(this,Object(l.a)(e).call(this,n))).canvasRef=i.a.createRef(),t.signIn=function(n){n.preventDefault();var e=t.state.userSession,a=window.location,i=a.origin,o=a.pathname;e.redirectToSignIn("".concat(i).concat(o),"".concat(i).concat(o,"manifest.json"))},t.signOut=function(n){n.preventDefault(),t.state.userSession.signUserOut();var e=window.location,a=e.origin,i=e.pathname;window.location.assign("".concat(a).concat(i))},t.savePainting=function(n){n.preventDefault();var e=t.state.userSession,a=t.canvasRef.current;a&&e.putFile("painting.json",JSON.stringify({data:a.toDataURL("image/png"),createdAt:Date.now()}),{encrypt:!1})},t.fetchPainting=function(){var n=t.state.userSession;return t.canvasRef.current?n.getFile("painting.json",{decrypt:!1}):Promise.resolve(JSON.stringify({}))};var a=new v.AppConfig(["store_write","publish_data"]),o=new v.UserSession({appConfig:a});return t.state={appConfig:a,userSession:o},t}return Object(h.a)(e,n),Object(r.a)(e,[{key:"UNSAFE_componentWillMount",value:function(){var n=this.state.userSession;n.isSignInPending()&&n.handlePendingSignIn().then(function(){var n=window.location,e=n.origin,t=n.pathname;window.location.assign("".concat(e).concat(t))})}},{key:"render",value:function(){var n=this.state.userSession;return i.a.createElement("div",{className:"app"},n.isUserSignedIn()?i.a.createElement(p,{canvasRef:this.canvasRef,fetchPainting:this.fetchPainting,person:new v.Person(n.loadUserData().profile),savePainting:this.savePainting,signOut:this.signOut}):i.a.createElement(w,{signIn:this.signIn}))}}]),e}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(561);s.a.render(i.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(n){n.unregister()})}},[[238,1,2]]]);
//# sourceMappingURL=main.8733a195.chunk.js.map